#! /bin/csh -ef

if ( -e $MIRLIB/libmir.a ) then
  if ( ! -e $MIRLIB/Last_ranlib ) then
    set out = junk
  else
    set out = (`find $MIRLIB -name libmir.a -newer $MIRLIB/Last_ranlib -print`)
  endif
  if ($#out != 0) then
    echo "Running ranlib ..."
    ranlib $MIRLIB/libmir.a
    echo "`date` `hostname` `whoami`" >> $MIRLIB/Last_ranlib
  endif
endif

foreach name ($*)
  set file = $name:t
  set file = $file:r
  set tmp=/tmp/tmp$$
  set doc = $file.doc
  set dir = $name:h
  if ( $dir == $name ) set dir = "."
  echo Processing $name
  switch($name)
    case *.for
      (cd $dir; ratty -s alpha -b -I $MIRINC $name $tmp.f)
      f77 -O -o $MIRBIN/$file $tmp.f `mirlibs` || f77 -non_shared -O -o $MIRBIN/$file $tmp.f `mirlibs` && rm core
      rm -f $tmp.f
      rm -f $doc
      doc -p $name
      if ( -e $doc ) then
        echo Updating $doc
        mv $doc $MIRPDOC
      endif
      breaksw
    case *.c:
      (cd $dir;cc -O -Dalpha -I$MIRINC -o $MIRBIN/$file $name)
      breaksw
    case *.csh:
      rm -f $MIRBIN/$file
      cp $name $MIRBIN/$file
      chmod +x $MIRBIN/$file
      breaksw
    case *.doc:
      cp $name $MIRPDOC
      breaksw
    default:
      echo Ignoring $name
      breaksw
  endsw
end
